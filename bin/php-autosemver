#!/usr/bin/env php
<?php
/*
 * Copyright (C) 2019 James Buncle (https://www.jbuncle.co.uk) - All Rights Reserved
 */
foreach ([__DIR__ . '/../../../autoload.php', __DIR__ . '/../vendor/autoload.php'] as $file) {
    if (file_exists($file)) {
        require $file;
        break;
    }
}

use AutomaticSemver\SemVerDiff;

$root = getcwd();

$params = $argv;
array_shift($params);

$flags = array_filter($params, function($val) {
    return strpos($val, '--') === 0;
});
$args = array_diff($params, $flags);

$startRevision = $args[0];
if (array_key_exists(1, $args)) {
    $endRevision = $args[1];
} else {
    $endRevision = 'HEAD';
}
$verbose = in_array('--verbose', $flags);

$includePaths = [];
$excludePaths = ['vendor', 'tests'];

$semVerDiff = new SemVerDiff($root, $includePaths, $excludePaths);
echo $semVerDiff->diff($startRevision, $endRevision, $verbose);
echo "\n"; // Stop odd % symbol in some bash windows